
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>åŒ—æµ·å­¦åœ’æœ­å¹Œé«˜æ ¡ï½œ2025 ãƒ‰ãƒƒã‚¸ãƒœãƒ¼ãƒ«å¤§ä¼šï¼ˆé–²è¦§å°‚ç”¨ï¼‰</title>
<style>
:root{
  --primary:#0a3d8f;--primary-dark:#062a63;--accent:#ffd24c;--mint:#2ec4b6;
  --bg:#f4f7fb;--card:#ffffff;--shadow:0 10px 24px rgba(0,0,0,.08);
  --radius:16px;--fast:.25s ease;
  --line-gray:#4b5a78;--line-active:#c8142e;
}
html,body{height:100%}
body{
  margin:0;font-family:"Noto Sans JP","Helvetica Neue",Arial,sans-serif;color:#1e2a3a;
  background:
    radial-gradient(circle at 20% 10%, rgba(10,61,143,.10), transparent 40%),
    radial-gradient(circle at 80% 0%, rgba(6,42,99,.10), transparent 45%),
    radial-gradient(100px 100px at 15% 85%, rgba(46,196,182,.10), transparent 50%),
    var(--bg);
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
header{
  position:relative;text-align:center;padding:56px 20px 36px;color:#fff;
  background:linear-gradient(135deg,var(--primary),var(--primary-dark) 70%);
  border-bottom:6px solid var(--accent);overflow:hidden;box-shadow:var(--shadow);
}
header h1{margin:0 0 4px 0;font-weight:900;letter-spacing:.06em;font-size:clamp(1.8rem,3.2vw,2.6rem)}
header p{margin:8px 0 0;opacity:.95}
header::after{
  content:"";position:absolute;left:-80px;bottom:-40px;width:120px;height:120px;border-radius:50%;
  background:radial-gradient(circle at 35% 30%, #8ab5ff 10%, #5e8fe6 35%, #2e5fbf 60%, #204da3 100%);
  box-shadow:0 12px 24px rgba(0,0,0,.18);animation:bounce 4.2s cubic-bezier(.25,.75,.35,1) infinite;opacity:.9
}
@keyframes bounce{
  0%{transform:translate(0,0) scale(1)}
  30%{transform:translate(40vw,-120px) scale(.98)}
  50%{transform:translate(60vw,0) scale(1.03)}
  80%{transform:translate(100vw,-160px) scale(.96)}
  100%{transform:translate(120vw,0) scale(1)}
}

/* ãƒ­ã‚´ï¼ãƒãƒƒã‚¸ */
.brand-wrap{display:flex;justify-content:center;align-items:center;gap:14px;margin-top:10px}
.fallback-logo{display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:999px;background:rgba(255,255,255,.12);backdrop-filter:blur(2px)}
.fallback-logo .ball{width:32px;height:32px;border-radius:50%;background:#cfe0ff;box-shadow:inset 0 0 0 4px #b8d1ff;position:relative}
.fallback-logo .ball::before,.fallback-logo .ball::after{content:"";position:absolute;inset:0;border-radius:50%;border:3px solid #8ab5ff;mix-blend-mode:multiply}
.fallback-logo .title{font-weight:900;letter-spacing:.08em}
.view-only-badge{
  display:inline-flex;align-items:center;gap:8px;margin-top:10px;padding:6px 10px;border-radius:999px;
  background:#fff7d6;border:2px solid #ffe9a3;color:#4a3600;font-weight:900
}

/* ãƒŠãƒ“ */
.nav-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin:22px auto;max-width:1240px;padding:0 16px}
.nav-item{
  background:#eaf0fb;border:2px solid transparent;color:#0b2e6b;
  padding:14px 12px;text-align:center;border-radius:14px;font-weight:800;cursor:pointer;
  box-shadow:var(--shadow);transition:transform var(--fast),background var(--fast),border-color var(--fast)
}
.nav-item:hover{transform:translateY(-3px);background:#dbe6fb;border-color:#a9c2ff}
.nav-item.active{background:var(--primary);color:#fff;border-color:var(--primary)}

/* æœ¬æ–‡ */
main{max-width:1240px;margin:0 auto;padding:0 16px 40px}
.section-title{font-size:1.2rem;margin:32px 0 8px;color:var(--primary);font-weight:900;letter-spacing:.02em;display:flex;align-items:center;gap:8px}
.section-title .dot{width:10px;height:10px;background:var(--accent);border-radius:50%;box-shadow:0 0 0 6px rgba(255,210,76,.18)}

.card,.box{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:22px;margin-top:16px}
.card{border:2px solid #d9e4ff}
.box{border:2px solid #e3ebff;overflow-x:auto}

/* PDFè¡¨ç¤º */
#pdf-viewer{width:100%;height:780px;border-radius:14px;border:3px solid #a9c2ff;display:none;margin-top:10px}

/* è¡¨å…±é€š */
table{width:100%;border-collapse:collapse;min-width:1000px}
th,td{border:1px solid #e3e7ef;padding:10px 8px;text-align:center}
th{background:#f0f4ff;color:var(--primary);font-weight:800}
.summary-col{background:#fffdf0;font-weight:900}
.res-symbol{font-weight:900;color:var(--primary)}
.res-score{color:#666;font-size:.86rem}

.hidden{display:none}
.notice{padding:14px;border-radius:12px;background:#fff7d6;border:2px solid #ffe9a3;color:#4a3600;font-weight:700}
.muted{color:#586680}

/* ===== ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆï¼ˆè¡¨ç¤ºç”¨ï¼‰ ===== */
.tournament-container{
  position:relative;display:flex;gap:40px;padding:30px 10px;background:#fff;overflow:auto;align-items:flex-start;
  min-height:420px;border-radius:14px;border:2px solid #d9e4ff;box-shadow:var(--shadow)
}
.bracket-column{display:flex;flex-direction:column;gap:24px;min-width:220px}
.t-match{width:220px;background:#fff;border:2px solid #4b5a78;border-radius:12px;box-shadow:2px 2px 5px rgba(0,0,0,.08);overflow:hidden}
.t-row{display:flex;align-items:center;gap:6px;padding:8px;border-bottom:1px solid #e6eefb}
.t-row:last-child{border-bottom:none}
.t-name input{width:100%;padding:6px 8px;border:2px solid #e0e9ff;border-radius:8px;font-weight:700}
.t-score{width:56px;height:32px;border-radius:8px;border:2px solid #c8d7ff;text-align:center;font-weight:900}
.t-row.win{background:#fff6f7}
#t-svg{position:absolute;inset:0;pointer-events:none}
.conn{stroke:var(--line-gray);stroke-width:2.2;fill:none}
.conn.active{stroke:var(--line-active);stroke-width:3.2;filter:drop-shadow(0 0 2px rgba(200,20,46,.35))}

/* é–²è¦§ãƒ¢ãƒ¼ãƒ‰ï¼šç·¨é›†ç³»ã‚’å®Œå…¨ç„¡åŠ¹åŒ– */
.readonly [contenteditable="true"]{pointer-events:none}
.readonly input, .readonly select, .readonly textarea{pointer-events:none;border-color:#e6eaf5;background:#f6f8fc;color:#3b4d6b}
.readonly input[readonly], .readonly input[disabled]{background:#f6f8fc}
.readonly button{display:none} /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…éƒ¨ã®ç·¨é›†ãƒœã‚¿ãƒ³ã¯éè¡¨ç¤ºï¼ˆãƒŠãƒ“ã¯é™¤å¤–ï¼‰ */
.readonly .tt-time{background:#f6f8fc}
.readonly .team-name{background:#f6f8fc}

/* å…¬é–‹ç”¨ã®çµæœã‚«ãƒ¼ãƒ‰ï¼ˆç·¨é›†UIã¨ã¯åˆ¥ï¼‰ */
.pub-results{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
.pub-card{grid-column:span 12;background:#fff;border:2px solid #d9e4ff;border-radius:14px;box-shadow:var(--shadow);padding:16px}
.pub-card h3{margin:0 0 10px 0;color:#0b2e6b}
.pub-list{margin:0;padding:0;list-style:none;display:grid;grid-template-columns:repeat(12,1fr);gap:8px}
.pub-item{grid-column:span 12;display:flex;gap:8px;align-items:center;padding:10px;border:1px solid #eef2ff;border-radius:10px;background:#fbfdff}
.pub-rank{min-width:96px;font-weight:900;color:#0a3d8f;background:#f0f4ff;border:1px solid #dfe7ff;border-radius:8px;padding:6px 10px;text-align:center}
.pub-value{flex:1;font-weight:700}
@media (min-width:720px){
  .pub-card{grid-column:span 6}
}
@media (min-width:1100px){
  .pub-card{grid-column:span 4}
}

/* ãƒ•ãƒƒã‚¿ãƒ¼ */
.footer{max-width:1240px;margin:20px auto 40px;padding:0 16px;color:#5b6a87;font-size:.9rem;display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap}
.footer .updated{font-weight:800;color:#0a3d8f}

/* å°åˆ· */
@media print{
  nav, .footer .links, .view-only-badge{display:none !important}
  body{background:#fff}
  main{padding-bottom:0}
}
</style>
</head>
<body>
  <header>
    <h1 id="title">2025å¹´åº¦ ãƒ‰ãƒƒã‚¸ãƒœãƒ¼ãƒ«å¤§ä¼šï¼ˆé–²è¦§å°‚ç”¨ï¼‰</h1>
    <p>åŒ—æµ·å­¦åœ’æœ­å¹Œé«˜ç­‰å­¦æ ¡ï½œå¤§ä¼šé‹å–¶ãƒ»è‡ªå‹•é›†è¨ˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆé–²è¦§å°‚ç”¨ï¼‰</p>
    <div class="brand-wrap">
      <span class="fallback-logo">
        <span class="ball"></span><span class="title">2025 DODGEBALL</span>
      </span>
      <span class="view-only-badge">ğŸ”’ é–²è¦§ãƒ¢ãƒ¼ãƒ‰</span>
    </div>
  </header>

  <nav class="nav-grid">
    <div id="btn-home" class="nav-item active" onclick="showPage('home-page')">å¤§ä¼šè¦é …ï¼ˆPDFï¼‰</div>
    <div id="btn-match" class="nav-item" onclick="showPage('match-page')">å¯¾æˆ¦è¡¨</div>
    <div id="btn-league" class="nav-item" onclick="showPage('league-page')">ãƒªãƒ¼ã‚°æˆ¦ï¼ˆé †ä½ï¼‰</div>
    <div id="btn-tournament" class="nav-item" onclick="showPage('tournament-page')">æ±ºå‹ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ</div>
    <div id="btn-results" class="nav-item" onclick="showPage('results-page')">çµæœï¼ˆå…¬é–‹ç”¨ï¼‰</div>
  </nav>

  <main class="readonly" id="app">
    <!-- PDF -->
    <section id="home-page">
      <h2 class="section-title"><span class="dot"></span> ğŸ“„ å¤§ä¼šè¦é …ï¼ˆPDFï¼‰</h2>
      <div class="card">
        <p class="muted" id="pdf-note">ç®¡ç†ãƒšãƒ¼ã‚¸ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸ PDF ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
        <iframe id="pdf-viewer" title="å¤§ä¼šè¦é …PDF"></iframe>
        <div id="pdf-empty" class="notice" style="display:none">PDFãŒæœªç™»éŒ²ã§ã™ã€‚ç®¡ç†ãƒšãƒ¼ã‚¸ã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚</div>
      </div>
    </section>

    <!-- å¯¾æˆ¦è¡¨ -->
    <section id="match-page" class="hidden">
      <h2 class="section-title"><span class="dot"></span> ğŸ”¥ å¯¾æˆ¦è¡¨</h2>
      <div id="matchWrapper" class="box"></div>
      <div id="match-empty" class="notice" style="display:none;margin-top:12px">å¯¾æˆ¦è¡¨ãŒã¾ã ä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</div>
    </section>

    <!-- ãƒªãƒ¼ã‚°æˆ¦ -->
    <section id="league-page" class="hidden">
      <h2 class="section-title"><span class="dot"></span> ğŸ“Š ãƒªãƒ¼ã‚°æˆ¦ï¼ˆè‡ªå‹•é›†è¨ˆã®è¡¨ç¤ºï¼‰</h2>
      <div id="leagueWrapper" class="box"></div>
      <div id="league-empty" class="notice" style="display:none;margin-top:12px">ãƒªãƒ¼ã‚°è¡¨ãŒã¾ã ä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</div>
    </section>

    <!-- ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ -->
    <section id="tournament-page" class="hidden">
      <h2 class="section-title"><span class="dot"></span> ğŸ† æ±ºå‹ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ</h2>
      <div id="tournamentWrapper" class="tournament-container">
        <svg id="t-svg"></svg>
      </div>
      <div id="t-empty" class="notice" style="display:none;margin-top:12px">ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆãŒã¾ã ä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</div>
    </section>

    <!-- çµæœï¼ˆå…¬é–‹ç”¨ï¼‰ -->
    <section id="results-page" class="hidden">
      <h2 class="section-title"><span class="dot"></span> ğŸ çµæœï¼ˆå…¬é–‹ç”¨ï¼‰</h2>
      <div id="resultsWrapper" class="box">
        <div id="pubResults" class="pub-results"></div>
      </div>
      <div id="results-empty" class="notice" style="display:none;margin-top:12px">å…¬é–‹ç”¨ã®çµæœãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</div>
    </section>
  </main>

  <div class="footer">
    <div class="updated">æœ€çµ‚æ›´æ–°ï¼š<span id="updatedAt">-</span></div>
    <div class="links">
      <button onclick="window.print()" style="padding:8px 12px;border-radius:10px;border:2px solid #d9e4ff;background:#fff">ğŸ–¨ å°åˆ·</button>
    </div>
  </div>

<script>
/* ========= åŸºæœ¬ãƒŠãƒ“ ========= */
function showPage(pageId){
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
  const btnId = 'btn-' + pageId.split('-')[0];
  const btn = document.getElementById(btnId);
  if(btn) btn.classList.add('active');

  ['home-page','match-page','league-page','tournament-page','results-page'].forEach(id=>{
    const sec = document.getElementById(id);
    const show = id === pageId;
    sec.classList.toggle('hidden', !show);
    if(show && sec.animate){
      sec.animate(
        [{opacity:0, transform:'translateY(6px)'},{opacity:1, transform:'none'}],
        {duration:250, easing:'ease-out'}
      );
    }
  });

  // è¡¨ç¤ºåˆ‡æ›¿æ™‚ã«ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã®ç·šã‚’æãç›´ã—
  if(pageId === 'tournament-page'){
    requestAnimationFrame(drawConnectors);
  }
}

/* ========= é–²è¦§å°‚ç”¨åŒ–ï¼ˆåŸ‹ã‚è¾¼ã¿HTMLã®ä¿è­·ï¼‰ ========= */
function makeReadOnly(root){
  // ã™ã¹ã¦ã® on* ã‚¤ãƒ™ãƒ³ãƒˆå±æ€§ã‚’é™¤å»
  root.querySelectorAll('*').forEach(el=>{
    [...el.attributes].forEach(a=>{
      if(/^on/i.test(a.name)) el.removeAttribute(a.name);
    });
  });
  // å…¥åŠ›ç³»ã‚’ç„¡åŠ¹åŒ–
  root.querySelectorAll('input,select,textarea,button').forEach(el=>{
    if(el.closest('nav')) return; // ãƒŠãƒ“ã¯ç„¡åŠ¹åŒ–ã—ãªã„
    if(el.tagName.toLowerCase()==='button'){
      // ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…éƒ¨ã®ç·¨é›†ãƒœã‚¿ãƒ³ã¯æ¶ˆã™
      el.style.display='none';
    }else{
      el.setAttribute('disabled','true');
      el.setAttribute('readonly','true');
    }
  });
  // contenteditable ã‚’ç„¡åŠ¹åŒ–
  root.querySelectorAll('[contenteditable]').forEach(el=>{
    el.setAttribute('contenteditable','false');
  });
}

/* ========= å…¬é–‹ç”¨ï¼šçµæœãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ========= */
function renderPublicResults(resultsV2, legacy){
  const wrap = document.getElementById('pubResults');
  wrap.innerHTML = '';
  const dataset = Array.isArray(resultsV2) && resultsV2.length ? resultsV2 : mapLegacy(legacy);

  if(!dataset.length){
    document.getElementById('results-empty').style.display='block';
    return;
  }
  document.getElementById('results-empty').style.display='none';

  dataset.forEach(section=>{
    const card = document.createElement('div');
    card.className = 'pub-card';
    const h = document.createElement('h3');
    h.textContent = section.title || 'ç¨®ç›®';
    card.appendChild(h);

    const ul = document.createElement('ul');
    ul.className = 'pub-list';
    (section.rows || []).forEach(r=>{
      const li = document.createElement('li');
      li.className = 'pub-item';
      const rk = document.createElement('span');
      rk.className = 'pub-rank';
      rk.textContent = r.rank || '-';
      const val = document.createElement('span');
      val.className = 'pub-value';
      val.textContent = r.value || '';
      li.appendChild(rk); li.appendChild(val);
      ul.appendChild(li);
    });

    card.appendChild(ul);
    wrap.appendChild(card);
  });

  function mapLegacy(legacyObj){
    if(!legacyObj) return [];
    const out=[];
    const push = (title, g)=>{
      if(!g) return;
      const rows=[];
      if(g.champion) rows.push({rank:'å„ªå‹', value:g.champion});
      if(g.runnerUp) rows.push({rank:'æº–å„ªå‹', value:g.runnerUp});
      if(g.third) rows.push({rank:'3ä½', value:g.third});
      out.push({title, rows});
    };
    push('ç”·å­', legacyObj.men);
    push('å¥³å­', legacyObj.women);
    push('MIX', legacyObj.mix);
    return out;
  }
}

/* ========= ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆç·šã®å†æç”»ï¼ˆé–²è¦§ã®ã¿ï¼‰ ========= */
function drawConnectors(){
  const wrapper = document.getElementById('tournamentWrapper');
  const svg = document.getElementById('t-svg');
  if(!wrapper || !svg) return;

  // SVG ã‚µã‚¤ã‚ºæ›´æ–°
  svg.setAttribute('width', wrapper.scrollWidth);
  svg.setAttribute('height', wrapper.scrollHeight);
  while(svg.firstChild) svg.removeChild(svg.firstChild);

  const matches = Array.from(wrapper.querySelectorAll('.t-match'));
  const children = matches.filter(m => m.dataset.parentId);

  const base = wrapper.getBoundingClientRect();
  children.forEach(child=>{
    const parent = document.getElementById(child.dataset.parentId);
    if(!parent) return;

    const cr = child.getBoundingClientRect();
    const pr = parent.getBoundingClientRect();

    const x1 = cr.right - base.left;
    const y1 = cr.top + cr.height/2 - base.top;
    const x2 = pr.left - base.left;
    const y2 = pr.top + pr.height/2 - base.top;
    const midX = (x1 + x2)/2;

    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    svg.appendChild(g);

    const mk = (id, cls, d) => {
      const p = document.createElementNS('http://www.w3.org/2000/svg','path');
      if(id) p.id = id;
      p.setAttribute('class', cls);
      p.setAttribute('d', d);
      p.setAttribute('data-parent', parent.id);
      g.appendChild(p);
      return p;
    };

    const d = `M ${x1} ${y1} L ${midX} ${y1} L ${midX} ${y2} L ${x2} ${y2}`;
    const gray = mk(null, 'conn', d);
    const red  = mk(`conn_${child.id}`, 'conn', d);
    const arm  = mk(`arm_${child.id}`, 'conn', `M ${midX} ${y2} L ${x2} ${y2}`);

    // ã™ã§ã«å‹è€…æƒ…å ±ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯èµ¤ç·šã‚’å¼·èª¿
    if(child.dataset.winner){
      red.classList.add('active');
      arm.classList.add('active');
    }
  });
}

/* ========= ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ ========= */
const STORAGE_KEY = 'kyugi_final_all_in_one';

function loadAll(){
  const raw = localStorage.getItem(STORAGE_KEY);
  let saved = null;
  try { saved = JSON.parse(raw || 'null'); } catch(e){ saved = null; }

  // ã‚¿ã‚¤ãƒˆãƒ«
  const titleEl = document.getElementById('title');
  titleEl.textContent = saved?.title || '2025å¹´åº¦ ãƒ‰ãƒƒã‚¸ãƒœãƒ¼ãƒ«å¤§ä¼šï¼ˆé–²è¦§å°‚ç”¨ï¼‰';

  // PDF
  const iframe = document.getElementById('pdf-viewer');
  const pdfNote = document.getElementById('pdf-note');
  const pdfEmpty = document.getElementById('pdf-empty');
  if(saved?.pdf){
    iframe.src = saved.pdf;
    iframe.style.display = 'block';
    pdfEmpty.style.display = 'none';
  }else{
    iframe.removeAttribute('src');
    iframe.style.display = 'none';
    pdfEmpty.style.display = 'block';
  }

  // å¯¾æˆ¦è¡¨
  const matchWrap = document.getElementById('matchWrapper');
  const matchEmpty = document.getElementById('match-empty');
  matchWrap.innerHTML = saved?.match || '';
  if(!matchWrap.innerHTML.trim()){
    matchEmpty.style.display='block';
  }else{
    matchEmpty.style.display='none';
    makeReadOnly(matchWrap);
  }

  // ãƒªãƒ¼ã‚°
  const leagueWrap = document.getElementById('leagueWrapper');
  const leagueEmpty = document.getElementById('league-empty');
  leagueWrap.innerHTML = saved?.league || '';
  if(!leagueWrap.innerHTML.trim()){
    leagueEmpty.style.display='block';
  }else{
    leagueEmpty.style.display='none';
    makeReadOnly(leagueWrap);
  }

  // ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ
  const tWrap = document.getElementById('tournamentWrapper');
  const tEmpty = document.getElementById('t-empty');
  // æ—¢å­˜SVGã‚’åˆæœŸåŒ–
  const keepSvg = document.getElementById('t-svg');
  tWrap.innerHTML = ''; // ãƒªã‚»ãƒƒãƒˆ
  const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.id = 't-svg';
  tWrap.appendChild(svg);
  // ä¿å­˜ HTML ã‚’é©ç”¨
  if(saved?.tournament){
    const tmp = document.createElement('div');
    tmp.innerHTML = saved.tournament;
    // ã‚‚ã—ä¿å­˜å´ã« t-svg ãŒå«ã¾ã‚Œã¦ã„ã‚Œã°ã€ãã®å­ï¼ˆãƒãƒƒãƒåˆ—ãªã©ï¼‰ã ã‘ç§»æ¤
    const savedSvg = tmp.querySelector('#t-svg');
    if(savedSvg){
      // savedSvg ä»¥å¤–ã®ãƒãƒ¼ãƒ‰ï¼ˆåˆ—ï¼‰ã‚’ç§»æ¤
      [...tmp.childNodes].forEach(n=>{
        if(!(n.nodeType===1 && n.id==='t-svg')) tWrap.appendChild(n);
      });
    }else{
      // ãã®ã¾ã¾ç§»æ¤
      tWrap.insertAdjacentHTML('beforeend', saved.tournament);
    }
    makeReadOnly(tWrap);
    tEmpty.style.display='none';
    requestAnimationFrame(drawConnectors);
  }else{
    tEmpty.style.display='block';
  }
  window.addEventListener('resize', drawConnectors);

  // çµæœï¼ˆå…¬é–‹ç”¨ï¼‰
  const resEmpty = document.getElementById('results-empty');
  const resWrap = document.getElementById('pubResults');
  resWrap.innerHTML = '';
  if((Array.isArray(saved?.resultsV2) && saved.resultsV2.length) || saved?.results){
    renderPublicResults(saved.resultsV2, saved.results);
    resEmpty.style.display='none';
  }else{
    resEmpty.style.display='block';
  }

  // æœ€çµ‚æ›´æ–°
  const upd = document.getElementById('updatedAt');
  upd.textContent = saved?.updatedAt ? formatJP(saved.updatedAt) : 'æœªä¿å­˜';
}

/* ========= æ—¥ä»˜è¡¨ç¤º ========= */
function formatJP(iso){
  try{
    const d = new Date(iso);
    const y=d.getFullYear(), m=d.getMonth()+1, dd=d.getDate();
    const hh = String(d.getHours()).padStart(2,'0');
    const mm = String(d.getMinutes()).padStart(2,'0');
    return `${y}å¹´${m}æœˆ${dd}æ—¥ ${hh}:${mm}`;
  }catch(e){ return iso || '-' }
}

/* ========= ã‚¿ãƒ–é–“åŒæœŸï¼ˆç®¡ç†â†’é–²è¦§ï¼‰ ========= */
const bc = ('BroadcastChannel' in window) ? new BroadcastChannel('kyugi_sync') : null;
if(bc){
  bc.addEventListener('message', ev=>{
    if(ev?.data?.type==='updated' && ev?.data?.key===STORAGE_KEY){
      softReload();
    }
  });
}
// storage ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆåˆ¥ã‚¿ãƒ–ã§ localStorage å¤‰æ›´æ™‚ï¼‰
window.addEventListener('storage', ev=>{
  if(ev.key === STORAGE_KEY) softReload();
});

let reloadTimer = null;
function softReload(){
  // è»½ã„ãƒ•ã‚§ãƒ¼ãƒ‰ã‚’ã‹ã‘ã¤ã¤å†èª­ã¿è¾¼ã¿
  const app = document.getElementById('app');
  app.animate([{opacity:1},{opacity:.5},{opacity:1}],{duration:500,easing:'ease'});
  // é€£ç¶šæ›´æ–°ã®ãƒãƒ¼ã‚¹ãƒˆæŠ‘åˆ¶
  clearTimeout(reloadTimer);
  reloadTimer = setTimeout(loadAll, 120);
}

/* ========= åˆæœŸåŒ– ========= */
window.addEventListener('load', ()=>{
  loadAll();
  showPage('home-page');
});
</script>
</body>
</html>
